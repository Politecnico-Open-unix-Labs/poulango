<!DOCTYPE html>
<html>
<head>
    <title>POuL manifesti</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="/static/gmaps.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Convergence|Bitter|Droid+Sans|Ubuntu+Mono' rel='stylesheet' type='text/css' />
    <script type="text/javascript">
        $(document).ready(function(){
            var map = new GMaps({
                div: '#map',
                lat: 45.478635,
                lng: 9.228206
            });
            map.setZoom(17);
            {% for posizione in posizioni %}
            map.addMarker({
                lat: {{posizione.latitudine|stringformat:"f"}},
                lng: {{posizione.longitudine|stringformat:"f"}},
                infoWindow: {
                    content: document.getElementById("desc-{{posizione.id}}")
                }
            });
            {% endfor %}
            {% for message in messages %}
                alert("{{message}}");
            {% endfor %}
        });
    </script>
    <style type="text/css" media="screen">
    #map {
        position:absolute;
        top: 0; bottom: 0; left: 0; right: 0;
    }

    .desc {
        margin-bottom: 1em;
        width: 20em;
    }

    .desc > hr {
        visibility: hidden;
    }
    </style>
</head>
<body>
    <p>Loading...</p>
    <div id="map"></div>

    {% for posizione in posizioni %}
    <div class="desc" id='desc-{{posizione.id}}'>
        <div>{{posizione.descrizione}}</div>
        <hr/>
        <form method='POST' action='.'>
            {% csrf_token %}
            <input type='text' name='token' placeholder='Token'/>
            <input type='hidden' name='id' value='{{posizione.id}}'/>
            <input type='submit' value='Fatto!'/>
        </form>
    </div>
    {% endfor %}
</body>
</html>
